

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>template &mdash; Uliweb Documentation 0.1.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Uliweb Documentation 0.1.4 documentation" href="index.html" />
    <link rel="next" title="upload(文件上传及显示处理)" href="app_upload.html" />
    <link rel="prev" title="rbac(权限控制)" href="app_rbac.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="app_upload.html" title="upload(文件上传及显示处理)"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="app_rbac.html" title="rbac(权限控制)"
             accesskey="P">上一页</a> |</li>
        <li><a href="index.html">Uliweb Documentation 0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="template">
<h1>template<a class="headerlink" href="#template" title="永久链接至标题">¶</a></h1>
<p>Uliweb中已经可以自动处理模板了，为什么还要提供template功能？它的作用有以下几点:</p>
<ol class="arabic simple">
<li>提供了一些有关模板处理的配置项</li>
<li>为模板添加了两个新的tag：use和link</li>
</ol>
<div class="section" id="id1">
<h2>模板处理的配置项<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>打开uliweb.contrib.template的settings.ini，可以看到:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">TEMPLATE</span><span class="p">]</span>
<span class="n">USE_TEMPLATE_TEMP_DIR</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">TEMPLATE_TEMP_DIR</span> <span class="o">=</span> <span class="s">&#39;tmp/templates_temp&#39;</span>
<span class="n">RAISE_USE_EXCEPTION</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>其中:</p>
<dl class="docutils">
<dt>USE_TEMPLATE_TEMP_DIR</dt>
<dd>表示是否使用编译缓存功能。Uliweb的模板是采用先编译成Python源代码再运行的方式。在缺省情况下，编译后的内容是放在内存中的，使用后就丢弃了。将这个选项置为True，可以将生成的Python源代码保存到一个临时目录下，如果下一次使用时，没有修改模板文件，则不再编译，直接使用缓存的文件进行执行。</dd>
<dt>TEMPLATE_TEMP_DIR</dt>
<dd>与上面的选项配套使用。用来指明编译后的模板文件缓存的目录。</dd>
<dt>RAISE_USE_EXCEPTION</dt>
<dd>在使用use标签时，如果找不到对应的模块是否抛出异常，缺省为抛出。</dd>
</dl>
</div>
<div class="section" id="use">
<h2>use 标签<a class="headerlink" href="#use" title="永久链接至标题">¶</a></h2>
<p>在处理静态文件时，如css, js文件，比较麻烦的就是你要手工将相关的链接信息写入html中，不仅你要考虑哪些css和js要导入，它们的顺序是如何的，有可能还要考虑对于依赖其它的app的静态文件的处理，比如某个ui组件是依赖于jquery的，应如何处理和避免重复引入。因此template use设计了一种动态导入静态链接的功能，并且可以支持依赖app的静态链接导入。</p>
<p>use 的语法形式为:</p>
<div class="highlight-python"><pre>{{use "name"}}
{{use "name", value1, var2=value2}}</pre>
</div>
<p>use后面为要导入的模块名，并且根据需要可以添加相应的变量。可以是位置参数或关键字参数。一般来说use相关的模板都是由app的提供者写好的，用户只是按要求使用即可。</p>
<div class="section" id="id2">
<h3>使用use的好处<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>你可以自由在模板中使用{{use}}，根据use定义的次序，uliweb会自动安排返回的css, js等代码的顺序。并且会去除重复的内容。如多次使用相同的{{use}}不会有重复的内容出现。并且，它可以自动检查&lt;head&gt;中已经存在的链接，避免重复。</p>
<p>你可以主动定义链接插入的位置，有两种：toplinks和bottomlinks。它们的写法是:</p>
<div class="highlight-python"><pre>&lt;!-- toplinks --&gt;
&lt;!-- bottomlinks --&gt;</pre>
</div>
<p>你可以把它们定义在模板中的任何地方。如果没有定义，那么分两种情况：</p>
<ol class="arabic simple">
<li>存在&lt;head&gt;标签，则toplinks对应于&lt;head&gt;之后。bottomlinks对应于&lt;/head&gt;之前。</li>
<li>不存在&lt;head&gt;标签，则全部显示在最前面。</li>
</ol>
</div>
<div class="section" id="id3">
<h3>use 使用说明<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>name为模块名，它需要定义在某个app的 <cite>template_plugins</cite> 目录下，这个目录需要是Python的package的写法(即目录下有一个 <cite>__init__.py</cite>)，文件主名和name是一致，如，name为jquery，则文件名为jquery.py。</p>
<p>以jqutils.py为例，在plugs/ui/jquery/jquitls.py中:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">ajaxForm</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hoverIntent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;jqutils/jqutils.css&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spin</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;jqutils/spin.min.js&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;jqutils/jqrselect.js&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;jqutils/jqutils.js&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ajaxForm</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;jqutils/jquery.form.js&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hoverIntent</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;jqutils/jquery.hoverIntent.minified.js&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;toplinks&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">,</span> <span class="s">&#39;depends&#39;</span><span class="p">:[(</span><span class="s">&#39;jquery&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;ui&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">})]}</span>
</pre></div>
</div>
<p>你只要在某个.py中定义一个call函数，use标签在找到后，会自动调用。其中app, var, env是use会根据模板运行环境来提供。后面的参数是与{{use &#8220;name&#8221;,xxxx}}中定义的参数相对应的。use会自动把name后的参数传入到call函数中。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">因为uliweb的模板是编译后运行的，因此use中传入的参数只会在编译时生效，在运行时就无效了。所以对于运行时才生效的变量应该通过在view中传入或在模板中进行定义。</p>
</div>
<p>在call中，你可以修改env，这样可以添加新的变量，不过目前很少有这么做的。另一个主要的作用就是返回链接信息。这些链接信息可以是.css, .js文件，比如上面的&#8217;jqutuils/spin.min.js&#8217;。use标签会自动根据后缀是.css, .js的转为静态的链接。其它的保持不变，因此你可以使用:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;!--[if lt IE 9]&gt;&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;bootstrap/asset/html5.js&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;![endif]--&gt;&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;bootstrap/bootstrap.min.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>传入一些代码片段。</p>
<p>返回时，需要是一个dict，它有两个key，一个是 &#8216;toplinks&#8217;, 一个是 &#8216;bottomlinks&#8217;。这是和前面所说的toplinks和bottomlinks的定义对应的。同时返回的dict中还可以包含depends或depends_after键字，它是用来指示外部依赖模块的。它的写法就是:</p>
<div class="highlight-python"><pre>'depends':['name1', 'name2']
'depends':[('name1', {'var1':'value1'})]</pre>
</div>
<p>有两种主要写法。第一种是列出外部依赖的use模块，全部是使用缺省参数调用，即只传入app, var, env。第二种是带参数的依赖写法，每项内容为一个tuple，第一个元素是模块名，第二个是一个dict，列出相关要传入的参数。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">depends用于定义所依赖的模块在本模块之前被定义。而depends_after用于定义所依赖的模块在当前模块之后被定义，例如:less.js的处理就要在.less文件之后被定义。</p>
</div>
</div>
</div>
<div class="section" id="link">
<h2>link 标签<a class="headerlink" href="#link" title="永久链接至标题">¶</a></h2>
<p>使用use是需要有人预先写好相关的模块，它的好处是可以一次性返回多个.css, .js的信息。但是有些情况可有很简单，那么就可以考虑使用link标签，格式为:</p>
<div class="highlight-python"><pre>{{link 'path/to/xxx.css', media='screen', to='toplinks'}}</pre>
</div>
<p>其中media对应是&#8217;screen&#8217;或&#8217;print&#8217;，缺省为&#8217;screen&#8217;。to用来指示是输出到toplinks还是bottomlinks。缺省是&#8217;toplinks&#8217;。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">template</a><ul>
<li><a class="reference internal" href="#id1">模板处理的配置项</a></li>
<li><a class="reference internal" href="#use">use 标签</a><ul>
<li><a class="reference internal" href="#id2">使用use的好处</a></li>
<li><a class="reference internal" href="#id3">use 使用说明</a></li>
</ul>
</li>
<li><a class="reference internal" href="#link">link 标签</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="app_rbac.html"
                        title="上一章">rbac(权限控制)</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="app_upload.html"
                        title="下一章">upload(文件上传及显示处理)</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/app_template.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="app_upload.html" title="upload(文件上传及显示处理)"
             >下一页</a> |</li>
        <li class="right" >
          <a href="app_rbac.html" title="rbac(权限控制)"
             >上一页</a> |</li>
        <li><a href="index.html">Uliweb Documentation 0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; 版权所有 2012, limodou.
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>