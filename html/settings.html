

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Settings说明 &mdash; Uliweb Documentation 0.1.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Uliweb Documentation 0.1.4 documentation" href="index.html" />
    <link rel="next" title="I18N 使用说明" href="i18n.html" />
    <link rel="prev" title="Heroku 部署说明" href="heroku.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="i18n.html" title="I18N 使用说明"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="heroku.html" title="Heroku 部署说明"
             accesskey="P">上一页</a> |</li>
        <li><a href="index.html">Uliweb Documentation 0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="settings">
<h1>Settings说明<a class="headerlink" href="#settings" title="永久链接至标题">¶</a></h1>
<div class="section" id="id1">
<h2>调用说明<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>在Uliweb中，配置信息一般是放在settings.ini文件中的，目前有以下几个级别的settings.ini
信息:</p>
<div class="highlight-python"><pre>default_settings.ini
apps/
    app/settings.ini
    settings.ini
    local_settings.ini</pre>
</div>
<p>从上往下看，我们可以看到有缺省的settings信息，也有app级别的settings信息，还有整
个项目的settings信息，最后是项目的本地settings信息。它们的加载顺序是从上到下，
因此，后加载的项一旦发现有重名的情况，会进行以下特殊的处理:</p>
<ol class="arabic">
<li><p class="first">如果值为list, dict，则进行合并处理，即对于list，执行extend()，对于dict执行update</p>
</li>
<li><p class="first">如果是其它的值，则进行替換，即后面定义的值覆盖前面定义的值</p>
</li>
<li><p class="first">如果写法为:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">name</span> <span class="o">&lt;=</span> <span class="n">value</span>
</pre></div>
</div>
<p>则不管value是什么都将进行替換。</p>
</li>
</ol>
</div>
<div class="section" id="settings-ini">
<h2>settings.ini格式<a class="headerlink" href="#settings-ini" title="永久链接至标题">¶</a></h2>
<p>settings.ini的写法是类ini格式，但是和标准的ini有所区别:</p>
<ol class="arabic">
<li><p class="first">基本写法是:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">section</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<p>其中section是节的名字，可以是一般字符串或标识符。大小写敏感。</p>
<dl class="docutils">
<dt>name</dt>
<dd><p class="first last">是key，不应包含 &#8216;=&#8217;</p>
</dd>
<dt>value</dt>
<dd><p class="first last">是值，并且是符合python语法的，因此你可以写list, dict, tuple, 三重字符串和
其它的标准的python的类型。可以在符合python语法的情况下占多行。</p>
</dd>
</dl>
</li>
<li><p class="first">不支持多级，只支持两级处理</p>
</li>
<li><p class="first">注释写法是第一列为 <tt class="docutils literal"><span class="pre">'#'</span></tt></p>
</li>
<li><p class="first">可以在文件头定义 <tt class="docutils literal"><span class="pre">#coding=utf-8</span></tt> 来声明此文件的编码，以便可以使用 <tt class="docutils literal"><span class="pre">u'中文'</span></tt> 这样的内容。</p>
</li>
<li><p class="first">可以使用 <tt class="docutils literal"><span class="pre">_('English')</span></tt> 这样的编译字符串，_()函数将被定义为 ugettext_lazy</p>
</li>
<li><p class="first">可以使用 <tt class="docutils literal"><span class="pre">[include:/project/local.ini]</span></tt> 这样的声明，用来在当前位置引入外部的 ini 文件。</p>
</li>
</ol>
<p>settings的处理是由Uliweb在启动时按照以上的顺序自动解析并且合并的。对于app下的settings.ini文件，它会按照app的定义顺序来处理。</p>
</div>
<div class="section" id="pyini">
<h2>pyini模块<a class="headerlink" href="#pyini" title="永久链接至标题">¶</a></h2>
<p>整个settings的处理都是由pyini模块来处理的。它存在于uliweb/utils目录下，在程序中
的使用如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">uliweb.utils</span> <span class="kn">import</span> <span class="n">pyini</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">pyini</span><span class="o">.</span><span class="n">Ini</span><span class="p">(</span><span class="s">&#39;inifile&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>这样就可以打开一个ini文件。如果有多个ini文件要进行合并处理，则使用 <tt class="docutils literal"><span class="pre">read()</span></tt> 继续处理即可，如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&#39;another.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>settings.ini文件可以保存，如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>settings的使用<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>settings在读取后会生成一个对象，它有几种使用方式:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">settings[section][key]</span></tt> 以字典的形式来处理</li>
<li><tt class="docutils literal"><span class="pre">settings.get_var('section/key',</span> <span class="pre">default=None)</span></tt> 这种形式可以写一个查找的路径的形式</li>
<li><tt class="docutils literal"><span class="pre">settings.section</span></tt> 或 <tt class="docutils literal"><span class="pre">settings.section.key</span></tt> 以 <tt class="docutils literal"><span class="pre">.</span></tt> 的形式来引用section和key，不过要求section和key是标识符，且不能是保留字。</li>
<li><tt class="docutils literal"><span class="pre">for</span> <span class="pre">k,</span> <span class="pre">v</span> <span class="pre">in</span> <span class="pre">settings.section.items()</span></tt> 可以把settings.section当成一个字典来使用，因此字典的许多方法都可以使用，如 in, has 之类的。</li>
</ol>
<p>在views方法中，可以直接使用settings对象。在非view方法中，可以先导入再使用:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">uliweb</span> <span class="kn">import</span> <span class="n">settings</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>重要配置参数说明<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>以下按不同的节(section)来区分</p>
<div class="section" id="global">
<h3>GLOBAL<a class="headerlink" href="#global" title="永久链接至标题">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">GLOBAL</span><span class="p">]</span>
<span class="n">TEMPLATE_SUFFIX</span> <span class="o">=</span> <span class="s">&#39;.html&#39;</span>   <span class="c">#模板文件后缀</span>
<span class="n">ERROR_PAGE</span> <span class="o">=</span> <span class="s">&#39;error&#39;</span> <span class="o">+</span> <span class="n">TEMPLATE_SUFFIX</span> <span class="c">#错误页面文件名</span>
<span class="n">WSGI_MIDDLEWARES</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c">#WSGI中间件</span>
<span class="n">HTMLPAGE_ENCODING</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span> <span class="c">#页面文件编码</span>
<span class="n">FILESYSTEM_ENCODING</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c">#文件系统编码，在linux上，建议进行相应的设置</span>
<span class="n">DEFAULT_ENCODING</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span>  <span class="c">#缺省编码</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="bp">None</span>            <span class="c">#时区设置</span>
<span class="n">LOCAL_TIME_ZONE</span> <span class="o">=</span> <span class="bp">None</span>      <span class="c">#本地时区</span>
<span class="n">TEMPLATE_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%(view_class)s</span><span class="s">/</span><span class="si">%(function)s</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%(function)s</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="c">#不同view方法的模板路径形式，前者为类形式，</span>
                            <span class="c">#后者为函数形式</span>
<span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c">#全局的模板路径，当所有app中都找不到模板时，将在</span>
                            <span class="c">#这个目录下进行查找</span>
</pre></div>
</div>
<p>其中 <tt class="docutils literal"><span class="pre">TEMPLATE_TEMPLATE</span></tt> 用于对应不同的view形式的模板路径方式。对于类，缺省是
在templates下为 <tt class="docutils literal"><span class="pre">classname/function.html</span></tt> 的形式。而函数形式的view则直接对应
templates下的 <tt class="docutils literal"><span class="pre">function.html</span></tt> 。</p>
</div>
<div class="section" id="log">
<h3>LOG<a class="headerlink" href="#log" title="永久链接至标题">¶</a></h3>
<p>详情参见 <a class="reference external" href="log.html">日志处理说明</a> 。</p>
</div>
<div class="section" id="functions">
<h3>FUNCTIONS<a class="headerlink" href="#functions" title="永久链接至标题">¶</a></h3>
<p>用于定义公共的一些函数，例如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">FUNCTIONS</span><span class="p">]</span>
<span class="n">flash</span> <span class="o">=</span> <span class="s">&#39;uliweb.contrib.flashmessage.flash&#39;</span>
</pre></div>
</div>
<p>在此定义之后，可以有以下两种引用形式:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">uliweb</span> <span class="kn">import</span> <span class="n">function</span>
<span class="n">flash</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="s">&#39;flash&#39;</span><span class="p">)</span>
<span class="n">flash</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="c">#或</span>

<span class="kn">from</span> <span class="nn">uliweb</span> <span class="kn">import</span> <span class="n">functions</span>
<span class="n">functions</span><span class="o">.</span><span class="n">flash</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="decorators">
<h3>DECORATORS<a class="headerlink" href="#decorators" title="永久链接至标题">¶</a></h3>
<p>用于定义公共的一些decorator函数，类似于FUNCTIONS的使用方式，但是区分为全部是decorator。</p>
<p>使用形式为:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">uliweb</span> <span class="kn">import</span> <span class="n">decorators</span>
<span class="nd">@decorators.check_role</span><span class="p">(</span><span class="s">&#39;superuser&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="binds">
<h3>BINDS<a class="headerlink" href="#binds" title="永久链接至标题">¶</a></h3>
<p>用于绑定某个信号的配置，例如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">BINDS</span><span class="p">]</span>
<span class="n">audit</span><span class="o">.</span><span class="n">post_save</span> <span class="o">=</span> <span class="s">&#39;post_save&#39;</span>
</pre></div>
</div>
<p>在配置中，每个绑定的函数应有一个名字，在最简单的情况下，可以省略名字，函数名就
与绑定名相同。</p>
<p>BINDS有三种定义形式:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">function</span> <span class="o">=</span> <span class="n">topic</span>            <span class="c">#最简单情况，函数名与绑定名相同，topic是对应的信号</span>
<span class="n">bind_name</span> <span class="o">=</span> <span class="n">topic</span><span class="p">,</span> <span class="n">function</span> <span class="c">#给出信号和函数路径</span>
<span class="n">bind_name</span> <span class="o">=</span> <span class="n">topic</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="p">{</span><span class="n">kwargs</span><span class="p">}</span> <span class="c">#给出信号，函数路径和参数(字典形式)</span>
</pre></div>
</div>
<p>其中function中是函数路径，比如 <tt class="docutils literal"><span class="pre">appname.model.function_name</span></tt> ，例用这种形式，uliweb
可以根据 <tt class="docutils literal"><span class="pre">appname.model</span></tt> 来导入函数。</p>
</div>
<div class="section" id="exposes">
<h3>EXPOSES<a class="headerlink" href="#exposes" title="永久链接至标题">¶</a></h3>
<p>用于配置URL，在一般情况下，你只要在views.py中定义 <tt class="docutils literal"><span class="pre">&#64;expose(url)</span></tt> 即可，但是在复杂情况
下，特别是可以允许URL被替换的情况下，考虑把URL定义在settings.ini中，如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">EXPOSES</span><span class="p">]</span>
<span class="n">login</span> <span class="o">=</span> <span class="s">&#39;/login&#39;</span><span class="p">,</span> <span class="s">&#39;uliweb.contrib.auth.views.login&#39;</span>
<span class="n">logout</span> <span class="o">=</span> <span class="s">&#39;/logout&#39;</span><span class="p">,</span> <span class="s">&#39;uliweb.contrib.auth.views.logout&#39;</span>
</pre></div>
</div>
<p>URL在Uliweb中是可以给每个URL起个名字的，以便在反向获取时只使用这个名字，同时它也可以用来方便进行替換。</p>
<p>它也有三种定义方式，类似于BINDS的定义:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">function</span> <span class="o">=</span> <span class="n">url</span>            <span class="c">#最简单情况，函数名与url名相同</span>
<span class="n">url_name</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span> <span class="n">function</span>  <span class="c">#给出url, 函数路径和url名</span>
<span class="n">url_name</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="p">{</span><span class="n">kwargs</span><span class="p">}</span> <span class="c">#给出url，函数路径，url名和参数(字典形式)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">Settings说明</a><ul>
<li><a class="reference internal" href="#id1">调用说明</a></li>
<li><a class="reference internal" href="#settings-ini">settings.ini格式</a></li>
<li><a class="reference internal" href="#pyini">pyini模块</a></li>
<li><a class="reference internal" href="#id2">settings的使用</a></li>
<li><a class="reference internal" href="#id3">重要配置参数说明</a><ul>
<li><a class="reference internal" href="#global">GLOBAL</a></li>
<li><a class="reference internal" href="#log">LOG</a></li>
<li><a class="reference internal" href="#functions">FUNCTIONS</a></li>
<li><a class="reference internal" href="#decorators">DECORATORS</a></li>
<li><a class="reference internal" href="#binds">BINDS</a></li>
<li><a class="reference internal" href="#exposes">EXPOSES</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="heroku.html"
                        title="上一章">Heroku 部署说明</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="i18n.html"
                        title="下一章">I18N 使用说明</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/settings.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="i18n.html" title="I18N 使用说明"
             >下一页</a> |</li>
        <li class="right" >
          <a href="heroku.html" title="Heroku 部署说明"
             >上一页</a> |</li>
        <li><a href="index.html">Uliweb Documentation 0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; 版权所有 2012, limodou.
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>